var RedisConnectionManager, RedisError, createError, errors, redis, url;

url = require('url');

redis = require('redis');

errors = require('./errors');

createError = errors.createError;

RedisError = errors.RedisError;

RedisConnectionManager = (function() {
  function RedisConnectionManager() {}

  RedisConnectionManager.prototype._connectedClients = {};

  RedisConnectionManager.prototype._connectedClientsCallbacks = {};

  RedisConnectionManager.prototype._connectedClientsRetainCounts = {};

  RedisConnectionManager.prototype.connectedClientsForURL = function(redisURL) {
    if (this._connectedClients[redisURL] == null) {
      this._connectedClients[redisURL] = {};
    }
    return this._connectedClients[redisURL];
  };

  RedisConnectionManager.prototype.connectedClientsCallbacksForURL = function(redisURL) {
    if (this._connectedClientsCallbacks[redisURL] == null) {
      this._connectedClientsCallbacks[redisURL] = {};
    }
    return this._connectedClientsCallbacks[redisURL];
  };

  RedisConnectionManager.prototype.connectedClientsRetainCountsForURL = function(redisURL) {
    if (this._connectedClientsRetainCounts[redisURL] == null) {
      this._connectedClientsRetainCounts[redisURL] = {};
    }
    return this._connectedClientsRetainCounts[redisURL];
  };

  RedisConnectionManager.prototype.obtainClient = function(redisURL, id, cb) {
    var connectedClientsCallbacksForURL, connectedClientsForURL, connectedClientsRetainCountsForURL;
    connectedClientsForURL = this.connectedClientsForURL(redisURL);
    connectedClientsCallbacksForURL = this.connectedClientsCallbacksForURL(redisURL);
    connectedClientsRetainCountsForURL = this.connectedClientsRetainCountsForURL(redisURL);
    if (connectedClientsForURL[id] != null) {
      connectedClientsRetainCountsForURL[id] += 1;
      return cb(null, connectedClientsForURL[id]);
    }
    if (connectedClientsCallbacksForURL[id] != null) {
      return connectedClientsCallbacksForURL[id].push(cb);
    }
    connectedClientsCallbacksForURL[id] = [cb];
    connectedClientsRetainCountsForURL[id] = 0;
    return this._createClient(redisURL, function(err, client) {
      var callback, i, len, ref;
      if (!err) {
        connectedClientsForURL[id] = client;
      }
      if (!connectedClientsCallbacksForURL[id]) {
        return;
      }
      ref = connectedClientsCallbacksForURL[id];
      for (i = 0, len = ref.length; i < len; i++) {
        callback = ref[i];
        if (client) {
          connectedClientsRetainCountsForURL[id] += 1;
        }
        callback(err, client);
      }
      return connectedClientsCallbacksForURL[id] = void 0;
    });
  };

  RedisConnectionManager.prototype.returnClient = function(redisURL, id) {
    var connectedClientsForURL, connectedClientsRetainCountsForURL;
    connectedClientsForURL = this.connectedClientsForURL(redisURL);
    connectedClientsRetainCountsForURL = this.connectedClientsRetainCountsForURL(redisURL);
    connectedClientsRetainCountsForURL[id] -= 1;
    if (!connectedClientsRetainCountsForURL[id]) {
      connectedClientsForURL[id].quit();
      return connectedClientsForURL[id] = void 0;
    }
  };

  RedisConnectionManager.prototype._createClient = function(redisURL, cb) {
    var client, database, parsed_auth, parsed_url, password, path, ref, ref1;
    parsed_url = url.parse(redisURL);
    parsed_auth = ((ref = parsed_url.auth) != null ? ref : '').split(':');
    password = parsed_auth[1];
    path = ((ref1 = parsed_url.pathname) != null ? ref1 : '/').slice(1);
    database = path.length ? path : '0';
    client = redis.createClient(parsed_url.port, parsed_url.hostname);
    if (password) {
      client.auth(password, function(err) {
        if (err) {
          return cb(createError(err, client));
        }
        return cb(null);
      });
    }
    client.select(database);
    client.on('ready', function() {
      client.send_anyways = true;
      client.select(database);
      client.send_anyways = false;
      return cb(null, client);
    });
    return client.on('error', function(err) {
      if (err) {
        return cb(createError(err, client));
      }
      return cb(null);
    });
  };

  return RedisConnectionManager;

})();


/* */

exports.RedisConnectionManager = new RedisConnectionManager();

exports.RedisError = RedisError;

//# sourceMappingURL=data:application/json;base64,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O0FBeUZBO0FBQUEsS0F6RkE7O0FBQUEsT0EyRk8sQ0FBQyxzQkFBUixHQUFxQyxJQUFBLHNCQUFBLENBQUEsQ0EzRnJDLENBQUE7O0FBQUEsT0E0Rk8sQ0FBQyxVQUFSLEdBQXFCLFVBNUZyQixDQUFBIiwiZmlsZSI6ImluZGV4LmpzIiwic291cmNlUm9vdCI6Ii9zb3VyY2UvIiwic291cmNlc0NvbnRlbnQiOlsidXJsICAgICA9IHJlcXVpcmUoJ3VybCcpXG5yZWRpcyAgID0gcmVxdWlyZSgncmVkaXMnKVxuZXJyb3JzICA9IHJlcXVpcmUoJy4vZXJyb3JzJylcblxuY3JlYXRlRXJyb3IgPSBlcnJvcnMuY3JlYXRlRXJyb3JcblJlZGlzRXJyb3IgID0gZXJyb3JzLlJlZGlzRXJyb3JcblxuY2xhc3MgUmVkaXNDb25uZWN0aW9uTWFuYWdlclxuICBfY29ubmVjdGVkQ2xpZW50czogICAgICAgICAgICAge31cbiAgX2Nvbm5lY3RlZENsaWVudHNDYWxsYmFja3M6ICAgIHt9XG4gIF9jb25uZWN0ZWRDbGllbnRzUmV0YWluQ291bnRzOiB7fVxuXG4gIGNvbm5lY3RlZENsaWVudHNGb3JVUkw6IChyZWRpc1VSTCkgLT5cbiAgICB1bmxlc3MgQF9jb25uZWN0ZWRDbGllbnRzW3JlZGlzVVJMXT9cbiAgICAgIEBfY29ubmVjdGVkQ2xpZW50c1tyZWRpc1VSTF0gPSB7fVxuXG4gICAgcmV0dXJuIEBfY29ubmVjdGVkQ2xpZW50c1tyZWRpc1VSTF1cblxuICBjb25uZWN0ZWRDbGllbnRzQ2FsbGJhY2tzRm9yVVJMOiAocmVkaXNVUkwpIC0+XG4gICAgdW5sZXNzIEBfY29ubmVjdGVkQ2xpZW50c0NhbGxiYWNrc1tyZWRpc1VSTF0/XG4gICAgICBAX2Nvbm5lY3RlZENsaWVudHNDYWxsYmFja3NbcmVkaXNVUkxdID0ge31cblxuICAgIHJldHVybiBAX2Nvbm5lY3RlZENsaWVudHNDYWxsYmFja3NbcmVkaXNVUkxdXG5cbiAgY29ubmVjdGVkQ2xpZW50c1JldGFpbkNvdW50c0ZvclVSTDogKHJlZGlzVVJMKSAtPlxuICAgIHVubGVzcyBAX2Nvbm5lY3RlZENsaWVudHNSZXRhaW5Db3VudHNbcmVkaXNVUkxdP1xuICAgICAgQF9jb25uZWN0ZWRDbGllbnRzUmV0YWluQ291bnRzW3JlZGlzVVJMXSA9IHt9XG5cbiAgICByZXR1cm4gQF9jb25uZWN0ZWRDbGllbnRzUmV0YWluQ291bnRzW3JlZGlzVVJMXVxuXG4gIG9idGFpbkNsaWVudDogKHJlZGlzVVJMLCBpZCwgY2IpIC0+XG4gICAgY29ubmVjdGVkQ2xpZW50c0ZvclVSTCAgICAgICAgICAgICA9IEBjb25uZWN0ZWRDbGllbnRzRm9yVVJMIHJlZGlzVVJMXG4gICAgY29ubmVjdGVkQ2xpZW50c0NhbGxiYWNrc0ZvclVSTCAgICA9IEBjb25uZWN0ZWRDbGllbnRzQ2FsbGJhY2tzRm9yVVJMIHJlZGlzVVJMXG4gICAgY29ubmVjdGVkQ2xpZW50c1JldGFpbkNvdW50c0ZvclVSTCA9IEBjb25uZWN0ZWRDbGllbnRzUmV0YWluQ291bnRzRm9yVVJMIHJlZGlzVVJMXG5cbiAgICBpZiBjb25uZWN0ZWRDbGllbnRzRm9yVVJMW2lkXT9cbiAgICAgIGNvbm5lY3RlZENsaWVudHNSZXRhaW5Db3VudHNGb3JVUkxbaWRdICs9IDFcbiAgICAgIHJldHVybiBjYihudWxsLCBjb25uZWN0ZWRDbGllbnRzRm9yVVJMW2lkXSlcblxuICAgIHJldHVybiBjb25uZWN0ZWRDbGllbnRzQ2FsbGJhY2tzRm9yVVJMW2lkXS5wdXNoIGNiIGlmIGNvbm5lY3RlZENsaWVudHNDYWxsYmFja3NGb3JVUkxbaWRdP1xuXG4gICAgY29ubmVjdGVkQ2xpZW50c0NhbGxiYWNrc0ZvclVSTFtpZF0gPSBbY2JdXG4gICAgY29ubmVjdGVkQ2xpZW50c1JldGFpbkNvdW50c0ZvclVSTFtpZF0gPSAwXG5cbiAgICBAX2NyZWF0ZUNsaWVudCByZWRpc1VSTCwgKGVyciwgY2xpZW50KSAtPlxuICAgICAgY29ubmVjdGVkQ2xpZW50c0ZvclVSTFtpZF0gPSBjbGllbnQgdW5sZXNzIGVyclxuICAgICAgcmV0dXJuIHVubGVzcyBjb25uZWN0ZWRDbGllbnRzQ2FsbGJhY2tzRm9yVVJMW2lkXVxuICAgICAgZm9yIGNhbGxiYWNrIGluIGNvbm5lY3RlZENsaWVudHNDYWxsYmFja3NGb3JVUkxbaWRdXG4gICAgICAgIGNvbm5lY3RlZENsaWVudHNSZXRhaW5Db3VudHNGb3JVUkxbaWRdICs9IDEgaWYgY2xpZW50XG5cbiAgICAgICAgY2FsbGJhY2soZXJyLCBjbGllbnQpXG4gICAgICBjb25uZWN0ZWRDbGllbnRzQ2FsbGJhY2tzRm9yVVJMW2lkXSA9IHVuZGVmaW5lZFxuXG4gIHJldHVybkNsaWVudDogKHJlZGlzVVJMLCBpZCkgLT5cbiAgICBjb25uZWN0ZWRDbGllbnRzRm9yVVJMICAgICAgICAgICAgID0gQGNvbm5lY3RlZENsaWVudHNGb3JVUkwgcmVkaXNVUkxcblxuICAgIGNvbm5lY3RlZENsaWVudHNSZXRhaW5Db3VudHNGb3JVUkwgPSBAY29ubmVjdGVkQ2xpZW50c1JldGFpbkNvdW50c0ZvclVSTCByZWRpc1VSTFxuICAgIGNvbm5lY3RlZENsaWVudHNSZXRhaW5Db3VudHNGb3JVUkxbaWRdIC09IDFcblxuICAgIHVubGVzcyBjb25uZWN0ZWRDbGllbnRzUmV0YWluQ291bnRzRm9yVVJMW2lkXVxuICAgICAgY29ubmVjdGVkQ2xpZW50c0ZvclVSTFtpZF0ucXVpdCgpXG4gICAgICBjb25uZWN0ZWRDbGllbnRzRm9yVVJMW2lkXSA9IHVuZGVmaW5lZFxuXG4gIF9jcmVhdGVDbGllbnQ6IChyZWRpc1VSTCwgY2IpIC0+XG4gICAgcGFyc2VkX3VybCAgPSB1cmwucGFyc2UgcmVkaXNVUkxcbiAgICBwYXJzZWRfYXV0aCA9IChwYXJzZWRfdXJsLmF1dGggPyAnJykuc3BsaXQgJzonXG4gICAgcGFzc3dvcmQgICAgPSBwYXJzZWRfYXV0aFsxXVxuICAgIHBhdGggICAgICAgID0gKHBhcnNlZF91cmwucGF0aG5hbWUgPyAnLycpLnNsaWNlIDFcbiAgICBkYXRhYmFzZSAgICA9IGlmIHBhdGgubGVuZ3RoIHRoZW4gcGF0aCBlbHNlICcwJ1xuXG4gICAgY2xpZW50ID0gcmVkaXMuY3JlYXRlQ2xpZW50IHBhcnNlZF91cmwucG9ydCwgcGFyc2VkX3VybC5ob3N0bmFtZVxuXG4gICAgaWYgcGFzc3dvcmRcbiAgICAgIGNsaWVudC5hdXRoIHBhc3N3b3JkLCAoZXJyKSAtPlxuICAgICAgICByZXR1cm4gY2IgY3JlYXRlRXJyb3IoZXJyLCBjbGllbnQpIGlmIGVyclxuICAgICAgICBjYiBudWxsXG5cbiAgICBjbGllbnQuc2VsZWN0KGRhdGFiYXNlKVxuICAgIGNsaWVudC5vbiAncmVhZHknLCAoKSAtPlxuICAgICAgY2xpZW50LnNlbmRfYW55d2F5cyA9IHRydWVcbiAgICAgIGNsaWVudC5zZWxlY3QoZGF0YWJhc2UpXG4gICAgICBjbGllbnQuc2VuZF9hbnl3YXlzID0gZmFsc2VcbiAgICAgIGNiIG51bGwsIGNsaWVudFxuXG4gICAgY2xpZW50Lm9uICdlcnJvcicsIChlcnIpIC0+XG4gICAgICByZXR1cm4gY2IgY3JlYXRlRXJyb3IoZXJyLCBjbGllbnQpIGlmIGVyclxuICAgICAgY2IgbnVsbFxuXG5cbiMjIyAjIyNcbiMgRVhQT1JUU1xuZXhwb3J0cy5SZWRpc0Nvbm5lY3Rpb25NYW5hZ2VyID0gbmV3IFJlZGlzQ29ubmVjdGlvbk1hbmFnZXIoKVxuZXhwb3J0cy5SZWRpc0Vycm9yID0gUmVkaXNFcnJvclxuIl19